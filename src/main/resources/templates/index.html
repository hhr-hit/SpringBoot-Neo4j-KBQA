<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:th="http://www.thymeleaf.org"
	xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity3">
<head>
<meta charset="utf-8" />
<title>KBQA-京东家电商品销售问答</title>
<style type="text/css">
* {
	font-size: 14px;
	padding: 0;
	margin: 0;
}

.main {
	position: relative;
	margin: 20px auto;
	border: 1px solid steelblue;
	width: 430px;
	height: 500px;
}

.msgInput {
	display: block;
	width: 406px;
	height: 60px;
	margin: 10px auto;
}

.cqlInput {
	display: block;
	width: 280px;
	height: 90px;
	margin: 10px auto;
}


.neobtn {
	position: absolute;
	width: 100px;
	height: 29px;
	bottom: 5px;
	left: 10px;
	font-size: 18px;
	background-color: #4CAF50;
}

.historybtn {
	position: absolute;
	width: 100px;
	height: 29px;
	bottom: 5px;
	left: 165px;
	font-size: 18px;
	background-color: #008CBA;
}

.sendbtn {
	position: absolute;
	width: 100px;
	height: 29px;
	bottom: 5px;
	right: 10px;
	font-size: 18px;
	background-color: #555555;
	color: white;
}

.cqlbtn {
	position: absolute;
	width: 100px;
	height: 29px;
	bottom: 305px;
	right: 10px;
	font-size: 18px;
	background-color: #555555;
	color: white;
}

.content {
	list-style: none;
	width: 410px;
	height: 380px;
	margin: 5px auto;
	border: 1px dotted #D1D3D6;
	overflow-y: scroll;
}

.msgContent {
	width: auto;
	max-width: 250px;
	height: auto;
	word-break: break-all;
	margin: 5px;
	padding: 3px;
	border-radius: 5px;
	font-size: 15px;
}

.content .left {
	float: left;
	text-align: left;
	background-color: lightgrey;
}

.content .right {
	float: right;
	text-align: right;
	background-color: yellowgreen;
}
</style>
<style>
html,body {
    font-size: 14px;
    font-family: "微软雅黑", Helvetica, Tahoma, Arial, sans-serif;
    color: #000;
    background-color: #30333F;
    margin: 0;
    padding: 0;
}
img {
    border: 0;
}
.cf:before,.cf:after {
    display: table;
    content: "";
}
.cf:after {
    clear: both;
}
.cf {
    *zoom: 1;
}
canvas{
position: fixed;
    top: 0px;
}
</style>
<script type="text/javascript">
	window.onload = function() {

		/**
		 * 启动时，先访问后台，提前加载字典和模板
		 * 不算入问答历史
		 */
		ajax({
			url : '/rest/hhr/question/onload',
			success : function(res) {
				console.log(res);
			}
		})

		/**
		 * 查看历史按钮
		 */
		document.getElementById('historybtn').onclick = function() {
			historyMsg(); //点击按钮，发送消息
		}

		/**
		 * 查看历史按钮
		 */
		function historyMsg() {
			var ul = document.getElementById('content'); //获取容器
			var newLi = document.createElement('li'); //创建新的对话气泡-系统
			newLi.innerHTML = "您的问答历史如下"; //显示
			newLi.className = 'msgContent left';
			ul.appendChild(newLi); //加入容器中
			var div = document.createElement('div');//空白分割
			div.style = 'clear:both';
			ul.appendChild(div); //空白分割
			//ajax方式，访问后台
			ajax({
				url : '/rest/hhr/question/history',
				success : function(res) {
					console.log(res);
					var newLi = document.createElement('li'); //新建一行
					newLi.innerHTML = res;
					newLi.className = 'msgContent left';
					ul.appendChild(newLi); //加入容器中
					var div = document.createElement('div'); //新建一个对话气泡-系统回复
					div.style = 'clear:both'; //空白分割
					ul.appendChild(div); //加入容器中
					//input.value = ''; //重置输入框
					newLi.scrollIntoView(); //将元素滚动到可见位置
				}
			})
			newLi.scrollIntoView(); //将元素滚动到可见位置
		}

		/**
		 * 生成图谱按钮
		 */
		document.getElementById('neobtn').onclick = function() {
			neoMsg(); //点击按钮，发送消息
		}

		/**
		 * 生成图谱按钮
		 */
		function neoMsg() {
			var ul = document.getElementById('content'); //获取容器
			var newLi = document.createElement('li'); //创建新的对话气泡-系统
			newLi.innerHTML = "正在启动数据库导入程序..."; //显示
			newLi.className = 'msgContent left';
			ul.appendChild(newLi); //加入容器中
			var div = document.createElement('div');//空白分割
			div.style = 'clear:both';
			ul.appendChild(div); //空白分割
			//ajax方式，访问后端
			ajax({
				url : '/rest/hhr/question/neo',
				success : function(res) {
					console.log(res);
					//sleep(10000);
					function sleep (time) {
						return new Promise((resolve) => setTimeout(resolve, time));
					}
					sleep(10000).then(() => {
						var newLi = document.createElement('li'); //创建新的对话气泡-系统
						newLi.innerHTML = "数据库导入完成"; //显示
						newLi.className = 'msgContent left';
						ul.appendChild(newLi); //加入容器中
						var div = document.createElement('div');//空白分割
						div.style = 'clear:both';
						ul.appendChild(div); //空白分割
					})
				}
			})
		}

		/**
		 * 查询按钮
		 * 自助查询数据库
		 */
		document.getElementById('cqlbtn').onclick = function() {
			cqlMsg(); //点击按钮，发送消息
		}

		/**
		 * 查询按钮
		 * 消息发送与界面显示
		 */
		function cqlMsg() {
			var input = document.getElementById('cql_input'); //查找缓存，获取输入
			var result = document.getElementById('result'); //结果区域
			//ajax方式，发送查询语句
			ajax({
				url : '/rest/hhr/question/cql?cypher='+ input.value,
				success : function(res) {
					console.log(res);
					//结果输出
					document.getElementById("result").innerHTML = "数据库查询结果：<br>" + res;
				}
			})
			//input.value = '';
		}

		/**
		 * 提问按钮
		 * 点击按钮发送
		 */
		var input = document.getElementById('msg_input'); //查找缓存，获取输入
		document.getElementById('sendbtn').onclick = function() {
			sendMsg(); //点击按钮，发送消息
		}

		/**
		 * 提问按钮
		 * 按enter键发送
		 */
		document.onkeypress = function(event) {
			var e = event || window.event;
			var keycode = e.keyCode || e.which;
			console.log(e); //F12输出
			if (keycode == 13) {//按下enter键，发送消息
				sendMsg();
			}
		}

		/**
		 * 提问按钮
		 * 消息发送与界面显示
		 */
		function sendMsg() {
			var input = document.getElementById('msg_input'); //查找缓存，获取输入
			var ul = document.getElementById('content'); //获取容器

			var newLi = document.createElement('li'); //创建新的对话气泡-用户
			newLi.innerHTML = input.value; //显示
			newLi.className = 'msgContent right';
			ul.appendChild(newLi); //加入容器中

			var div = document.createElement('div');
			div.style = 'clear:both';
			ul.appendChild(div); //空白分割

			//ajax方式，发送问句
			ajax({
				url : '/rest/hhr/question/query?question='+ input.value,
				success : function(res) {				
					console.log(res);

					var obj = eval('(' + res + ')');
					//obj = JSON.parse(json_str);
					//obj = jQuery.parseJSON(json_str);

					var newLi = document.createElement('li'); //新建一行
					newLi.innerHTML = obj.answer;
					newLi.className = 'msgContent left';
					ul.appendChild(newLi); //加入容器中

					var div = document.createElement('div'); //新建一个对话气泡-系统回复
					div.style = 'clear:both'; //空白分割
					ul.appendChild(div); //加入容器中
					input.value = ''; //重置输入框
					newLi.scrollIntoView(); //将元素滚动到可见位置

					//处理流程输出
					var pro1 = "后端处理流程输出:<br>========开始加载问题模板========<br>模板文件：D:/_HhrWorkSpace/Java/SpringBoot-Neo4j-KBQA/myHanLP/data/question/question_classification.txt<br>按行读入文件，以 : 分割<br>构造 模板-序号 的哈希表 questionsPattern<br>========问题模板加载完毕========<br> <br>========开始加载词汇表文件========<br>词汇表位置：D:/_HhrWorkSpace/Java/SpringBoot-Neo4j-KBQA/myHanLP/data/question/vocabulary.txt<br>========词汇表文件加载完毕========<br> <br>========开始构造单词-序号 哈希表========<br>以 : 分割读取的文件字符数据流<br>========单词-序号 哈希表构造完毕========<br> <br>========开始加载问题训练集========<br>加载训练集0：某品牌的某类型家电<br>调试输出——问题模板0对应的向量：<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>加载训练集1：某种参数的某类型家电<br>调试输出——问题模板1对应的向量：<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>加载训练集2：有哪些厂商生产某类型家电<br>调试输出——问题模板2对应的向量：<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>[1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]<br>加载训练集3：某个家电的价格<br>调试输出——问题模板3对应的向量：<br>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]<br>[0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]<br>[0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 1.0]<br>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0]<br>[0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 1.0]<br>加载训练集4：某品牌有哪些家电种类<br>========问题训练集加载完毕========<br> <br>========开始朴素贝叶斯分类训练========<br>转换训练集为RDD——弹性分布式数据集<br>Spark-NaiveBayes生成训练器，开始训练<br>========朴素贝叶斯分类训练结束========<br> <br>HanLP分词字典根目录为：D:/_HhrWorkSpace/Java/SpringBoot-Neo4j-KBQA/myHanLP/data/dictionary<br> <br>========用户自定义扩展词库开始加载========<br>加载名称字典，设置词性noj，频率0<br>加载动词字典，设置词性vsc，频率0<br>加载厂家字典，设置词性cj，频率0<br>加载参数字典，设置词性att，频率0<br>加载店铺字典，设置词性dp，频率0<br>加载品牌字典，设置词性ntc，频率0<br>加载家电种类字典，设置词性n，频率0<br>========用户自定义字典加载完毕========<br> <br>系统已收到用户在前端提交的问句，开始分析该问句<br> <br>";
					document.getElementById("process").innerHTML = pro1 + obj.process;
				}
			})

			input.value = '';
			newLi.scrollIntoView(); //将元素滚动到可见位置
		}

	}


	/**
	 * ajax
	 * XMLHTTP通讯方式
	 */
	function ajax(obj) {
		var xhr = null;
		if (window.ActiveXObject) {
			xhr = new ActiveXObject('Microsoft.XMLHTTP');
		} else {
			xhr = new XMLHttpRequest();
		}

		//打开与服务器的连接 //按需添加http头
		if (obj.method) {
			xhr.open(obj.method, obj.url, true);
		} else {
			xhr.open('get', obj.url, true);
		}
		xhr.setRequestHeader("Content-Type",
				"application/x-www-form-urlencoded");
		xhr.setRequestHeader("Authorization",
				"APPCODE 3e9dfb924f464e9593a95f9d2bbf4348");

		//通信状态监视
		xhr.onreadystatechange = function() {
			if (xhr.readyState == 4) {
				//数据接收完毕
				if (xhr.status == 200) {
					console.log('请求成功',xhr.responseText);
					if (obj.success) {
						obj.success(xhr.responseText); //返回答案res
					}
				} else {
					console.log(xhr.status,'请求出错')
					if (obj.failure) {
						obj.failure('请求失败')
					}
				}
			}
		}

		if (obj.method == undefined || obj.method.toLowerCase() == 'get') {
			xhr.send(null);
		} else {
			xhr.send(obj.params);
		}
	}
</script>

</head>
<body>
	<canvas id="canvas" width="1293" height="717"></canvas>

    <div style="position:absolute;background-color:transparent;height:700px;width:500px;" id="all">
    	<div style="float:left;background-color:transparent;height:680px;width:15px;" id="kong"></div>
		<div id="process" style="color:white;border:1px solid steelblue;float:left;background-color:transparent;height:680px;width:450px;overflow-y:scroll;font-size:16px">
				KBQA-后端处理流程输出:
		</div>
    </div>

	<div id="main" class="main">
		<ul id="content" class="content">
			<li class="msgContent left">
				您好，自动问答系统为您服务，你有什么家电销售方面的问题可以问我（目前本系统构建知识图谱的原始数据来源于京东）
			</li>
			<li class="msgContent left">
				根据您的问答历史记录，为您推荐以下问题：<br>海尔的冰箱有哪些？
			</li>
			<div style="clear: both"></div>
		</ul>
		<textarea id="msg_input" class="msgInput"></textarea>
		<button id="neobtn" class="neobtn">生成图谱</button>
		<button id="historybtn" class="historybtn">查看历史</button>
		<button id="sendbtn" class="sendbtn">提问</button>
	</div>

	<div style="position:absolute;left:1100px;top:20px;background-color:transparent;height:468px;width:300px;" id="thecql">
		<div id="cql" style="color:white;border:1px solid steelblue;float:left;background-color:transparent;height:468px;width:300px;font-size:16px">
			<div style="font-size: 16px">输入Cypher语句，查询Neo4j数据库：</div>
			<textarea id="cql_input" class="cqlInput"></textarea>
			<button id="cqlbtn" class="cqlbtn">查询</button>
			<div id="result" style="position:absolute;bottom:5px;margin:10px;color:white;border:1px solid steelblue;float:left;background-color:transparent;height:280px;width:280px;overflow-y:scroll;font-size:16px">
				数据库查询结果：<br>
			</div>
		</div>
	</div>

</body>

<script type="text/javascript">
window.requestAnimFrame = (function () {
    return window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        function (callback) {
            window.setTimeout(callback, 1000 / 60);
        };
})();
var can = document.getElementById("canvas");
var cxt = can.getContext("2d");
can.width = 1920;
can.height = 950;
cxt.lineWidth = 0.3;
//初始链接线条显示位置
var mousePosition = {
    x: 30 * can.width / 100,
    y: 30 * can.height / 100
}
//圆形粒子对象参数
var dots = {
    n: 500,//圆形粒子个数
    distance: 50,//圆形粒子之间的距离
    d_radius: 100,//粒子距离鼠标点的距离
    array: []//保存n个圆形粒子对象
}
//创建随即颜色值
function colorValue(min) {
    return Math.floor(Math.random() * 255 + min);
}
function createColorStyle(r, g, b) {
    return "rgba(" + r + "," + g + "," + b + ", 1)";
}
//混合两个圆形粒子的颜色
function mixConnect(c1, r1, c2, r2) {//圆的颜色 半径
    return (c1 * r1 + c2 * r2) / (r1 + r2);
};
//生成线条的颜色
function lineColor(dot1, dot2) {//获取具体的圆的颜色再计算
    var color1 = dot1.color,
        color2 = dot2.color;
    var r = mixConnect(color1.r, dot1.radius, color2.r, dot2.radius);
    var g = mixConnect(color1.g, dot1.radius, color2.g, dot2.radius);
    var b = mixConnect(color1.b, dot1.radius, color2.b, dot2.radius);
    return createColorStyle(Math.floor(r), Math.floor(g), Math.floor(b));
}
//生成圆形粒子的颜色对象
function Color(min) {
    min = min || 0;
    this.r = colorValue(min);
    this.g = colorValue(min);
    this.b = colorValue(min);
    this.style = createColorStyle(this.r, this.g, this.b);
}
//创建圆形粒子对象
function Dot() {
    //圆形粒子随机圆心坐标点
    this.x = Math.random() * can.width;
    this.y = Math.random() * can.height;
    //x y 方向运动的速度值
    this.vx = -0.5 + Math.random();
    this.vy = -0.5 + Math.random();

    this.radius = Math.random() * 5;
    //this.color = "#ff3333";
    this.color = new Color();
}
//绘制出圆形粒子
Dot.prototype.draw = function () {
    cxt.beginPath();
    cxt.fillStyle = this.color.style;
    cxt.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
    cxt.fill();
}
//添加圆形粒子
function createCircle() {
	/*<![CDATA[*/  for (var i = 0; i < dots.n; i++) {
        dots.array.push(new Dot());
    }/*<![CDATA[*/
}
//绘制出圆形粒子
function drawDots() {
    for (var i = 0; i < dots.n; i++) {
        var dot = dots.array[i];
        dot.draw();
    }
}

//drawDots();
//移动
function moveDots() {
    for (var i = 0; i < dots.n; i++) {
        var dot = dots.array[i];
        //当圆形粒子对象碰壁的时候就反弹回来
        if (dot.y < 0 || dot.y > can.height) {
            dot.vx = dot.vx;
            dot.vy = -dot.vy;
        } else if (dot.x < 0 || dot.x > can.width) {
            dot.vx = -dot.vx;
            dot.vy = dot.vy;
        }
        //给圆形粒子圆心坐标加上速度值移动圆形粒子
        dot.x += dot.vx;
        dot.y += dot.vy;
    }
}
//链接粒子对象
function connectDots() {
    for (var i = 0; i < dots.n; i++) {
        for (var j = 0; j < dots.n; j++) {
            iDot = dots.array[i];
            jDot = dots.array[j];
            /*<![CDATA[*/  if ((iDot.x - jDot.x) < dots.distance && (iDot.y - jDot.y) < dots.distance && (iDot.x - jDot.x) > -dots.distance && (iDot.y - jDot.y) > -dots.distance) {
                if ((iDot.x - mousePosition.x) < dots.d_radius && (iDot.y - mousePosition.y) < dots.d_radius && (iDot.x - mousePosition.x) > -dots.d_radius && (iDot.y - mousePosition.y) > -dots.d_radius) {
                    cxt.beginPath();
                    //cxt.strokeStyle = "yellow";
                    cxt.strokeStyle = lineColor(iDot, jDot);
                    cxt.moveTo(iDot.x, iDot.y);
                    cxt.lineTo(jDot.x, jDot.y);
                    cxt.closePath();
                    cxt.stroke();
                }

            }/*]]>*/
        }
    }
}
createCircle();
//让圆形粒子不断的移动
function animateDots() {
    cxt.clearRect(0, 0, can.width, can.height);
    moveDots();
    connectDots()
    drawDots();
    requestAnimFrame(animateDots);
}
animateDots();

can.onmousemove = function (ev) {
    var ev = ev || window.event;
    mousePosition.x = ev.pageX;
    mousePosition.y = ev.pageY;
}
can.onmouseout = function () {
    mousePosition.x = can.width / 2;
    mousePosition.y = can.height / 2;
}
</script>
</html>
